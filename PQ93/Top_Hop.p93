PQ93 CARTRIDGE - http://pennie.itch.io/pq93
version 1

__LUA__
level=0
map_off=0
start_y=64
mode="title"
jumping=0

fm=0
f=0
mc=0
sp=3
mx,my=mouse()

p={}
solids={}
springs={}

solid=(x,y)->
 return solids[mget((x)/8,(y)/8)]
spring=(x,y)->
 return springs[mget((x)/8,(y)/8)]

export _init=->
 solids={
  [1]:true,
  [2]:true,
  [3]:true,
  [5]:true,
  [6]:true,
  [7]:true,
  [8]:true,
  [11]:true,
  [12]:true,
  [14]:true,
  [15]:true,
  [16]:true,
  [17]:true,
  [18]:true
 }
 springs={
  [3]:true,
  [7]:true,
  [8]:true,
  [11]:true,
  [14]:true,
  [18]:true
 }
 map_off=level*20
 p={
  x:8+map_off*8,
  y:start_y,
  vx:0,
  vy:0,
  s:0.35,
  sprite:19
 }
 f=0
 mc=0
 sp=3

mus(0)
export _update=->

 if mode=="title" then
  if btn('a','p') then
   mode="game"
   sfx(5)

 elseif mode=="ending" then
  if btn('a','p') then
   level=0
   start_y=64
   _init!
   mode="title"
   mus(0)

 elseif mode=="pause" then
  if btn('a','p') then
   mode="game"
   sfx(4)

 elseif mode=="game" then

  p.s=0.35+level/15
  map_off=level*20

  if p.vy==0 then
   p.vx=p.s
  else
   if jumping==true then
    p.vx=p.s*1.75
   else
    p.vx=0

  if solid(p.x+p.vx,p.y+p.vy) or solid(p.x+7+p.vx,p.y+p.vy) or solid(p.x+p.vx,p.y+7+p.vy) or solid(p.x+7+p.vx,p.y+7+p.vy) then
   p.vx=0

  if solid(p.x,p.y+8+p.vy) or solid(p.x+7,p.y+8+p.vy) then
   p.vy=0
   jumping=false
  else
   p.vy=p.vy+0.2

  if p.vy==0 and mget(p.x/8,p.y/8+1)==2 then
   p.vy=-3.5
   jumping=true
   sfx(0)

  if p.vy<0 and (solid(p.x+p.vx,p.y+p.vx) or solid(p.x+7+p.vx,p.y+p.vy)) then
   p.vy=0

  if mget(p.x/8,p.y/8+1)==9 then
   _init!
   merge('Top_Hop')
   sfx(2)

  if mget(p.x/8,p.y/8)==13 then
   merge('Top_Hop')
   if level==7 then
    mode="ending"
    sfx(6)
   else
    p.x=p.x+16
    start_y=p.y
    level=level+1
    sp=3
    sfx(3)

  p.x=p.x+p.vx
  p.y=p.y+p.vy

  if mbtn('l') then
   if mc==0 then
    if spring(mx+map_off*8,my) and sp>0 then
     mset(mx/8+map_off,my/8,2)
     sp=sp-1
     sfx(1)
    elseif mget(mx/8+map_off,my/8)==2 and (p.vy>0 or jumping==false) then
     mset(mx/8+map_off,my/8,14)
     sp=sp+1
     sfx(1)
   mc=mc+1
  else
   mc=0

  if btn('a','p') then
   mode="pause"
   sfx(4)

  if p.vy==0 then
   p.sprite=19
   fm=(fm+p.s/5)%4
  elseif p.vy>0 then
   p.sprite=43
   fm=0
  elseif p.vy<0 then
   p.sprite=44
   fm=0

  f=flr(fm)

 mx,my=mouse()

export _draw=->
 cls()
 if mode=="title"
  map8(20,18,20,18,0,0)
  mtxt(4*8,9*8+5,"A Tiny Challenge",13)
  txt(3*8+4,13*8,"PRESS A/Z TO START",8)
  mtxt(4*8,17*8,"Mega Sparkmaster",4)
 elseif mode=="ending" then
  map8(0,18,20,18,0,0)
  txt(4*8,16,"CONGRATULATIONS!",7)
  txt(3*8,4*8,"You have finally",8)
  txt(3*8,5*8,"reached the exit...",8)
  mtxt(3*8,7*8,"Thanks for playing!",7)
  mtxt(3*8,8*8,"Press A/Z to return",15)
 elseif mode=="pause" then
  map8(map_off,0,20,18,0,0)
  spr(p.sprite+f,p.x-map_off*8,p.y)
  mtxt(10,10,"AREA "..level+1,8)
  mtxt(11*8+3,10,"SPRINGS: "..sp,4)
  txt(8*8,9*8,"PAUSE",8)
 elseif mode=="game" then
  map8(map_off,0,20,18,0,0)
  spr(23,flr(mx/8)*8,flr(my/8)*8)
  spr(p.sprite+f,p.x-map_off*8,p.y)
  mtxt(10,10,"AREA "..level+1,8)
  mtxt(11*8+3,10,"SPRINGS: "..sp,4)
 spr(24,mx,my)
__GFX__
000
000000007777777744f88f44bbbbbbbb
000000007776777641266214cc7ccc7c
000000006666666611c77c117ccb7ccb
00000000666566651b2662b1bbb5bbb5
00000000555555551b2662b155555555
000000005556555611c77c1155565556
00000000666666664126621466666666
000000006667666744f88f4466676667
6677777766777766abbbbbba00022200
6676777666767765bc7ccc7b00226100
5566666655666655bccb7ccb00266600
5565666555656651bbb5bbb1000cb000
bbb5bbb51155551111555511000cb000
bccb7ccb11565515115655150006e000
bc7ccc7c5566665555666655000ee000
abbbbbbb556766565567665600055000
010
a000000a7777776666777777bbbbbbba
0a0000a07776776566767776cc7ccc7b
00a00a0066666655556666667ccb7ccb
000aa0006665665155656665bbb5bbb1
000aa000555555111155555555555511
00a00a00555655151156555655565515
0a0000a0666666555566666666666655
a000000a666766565567666766676656
00000000000222000000000088888888
00022200002261000002220080000008
00226100002666000022610080000008
00266600000bc0000026660080000008
000cb000000bc000000bc00080000008
006bb000000e6000000eb60080000008
00dee000000ee00000eed00080000008
01105500000550000550110088888888
020
abbbbbbbffffffffa999999a4ff88ff4
bc7ccc7cffeeffee9aee99ee444ff444
bccb7ccbeeeeeeeeeeeeeeee4af88fa4
bbb5bbb5eeddeeddeeddeeddf4f88f4f
11555555ddddddddddddddddf4f88f4f
11565556ddeeddeeddeeddee4af88fa4
55666666eeeeeeeeeeeeeeee444ff444
55676667eeffeeffeeffeeff4ff88ff4
9999900004000400a000001115000400
988889000f000f000a00555556000f00
988999000f000f0000a6660056000f00
98989900080008000067080067000800
98998900080008000570080067000800
099999000f000f0005600f0056000f00
000000000f000f0016000f0056000f00
00000000040004001500040015000400
030
777777779bccccb94404404477777766
77767776bbc88cbb4a0000a477767765
66666666b9b88b9b00a00a0066666655
66656665bbc88cbb400aa00466656651
bbb5bbb59bccccb9400aa004bbb5bbb1
7ccb7ccbbbc88cbb00a00a007ccb7ccb
cc7ccc7cb9b88b9b4a0000a4cc7ccc7b
bbbbbbbbbbc88cbb44044044bbbbbbba
040005101000000a15566551a0001112
0f000650555000a0566776650a002226
0f00065006660a000f000f0000a02888
080007600807600008000800000a2888
080007600800750008000800000a2f88
0f0006500f0065000f000f0000a02fff
0f0006500f0006100f000f000a002fff
040005100400051004000400a0002226
001
226666222111000a000000000aa4f4aa
66777766622200a011111aaa0a4f8f4a
8888888888820a0022212a4a0aa4f4aa
8cccccc88882a000666264f401267621
88cccc8888f2a00077767f8f01126211
fffbbffffff20a00666264f401267621
fffffffffff200a022212a4a01267621
667777666222000a11111aaa01267621
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
011
0aa4f4aa0aa4f4aa1110000000000011
1a4f8f4a0a4f8f4a2221100000001122
1aa4f4aa0aa4f4aa6622210000012226
66726210001262767766121000121667
77661210001216676672621000126276
66222100000122261aa4f4aa0aa4f4aa
22211000000011220a4f8f4a0a4f8f4a
11100000000000110aa4f4aa0aa4f4aa
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
021
11111aaa11111aaa0aa4f4aa00022200
22212a4a22212a4aaa4f8f4a00226100
666264f4666264f4a4a4f4aa00266600
77767f8f77767f8f4f467621000cb000
666264f4666264f4f8f2621100cbba10
2aa4f44a22212a4a4f467621006eed00
1a4f8f4a11111aaaa4a676210000e100
0aa4f4aa00000000aaa6762100005000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
031
00022200000000000000000000000000
00226100000000000000000000000000
00266610000000000000000000000000
00ccba00000000000000000000000000
060bb000000000000000000000000000
000edd00000000000000000000000000
00ee0110000000000000000000000000
05500000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
__FLG__
0
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
1
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
2
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
3
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
__MAP__
0000
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040b0b040404040404040406
0504040404040b0b040404040b0b040404040406
05040404040b0b0b040404040b0b0b0404040410
050404040404040404040404040404040404040d
0103030704040404040404040404040408030303
0101010504040404040404040404040406010101
0101010504040404040404040404040406010101
010101010303070a0a0a0a0a0a08030301010101
0101010101010509090909090906010101010101
0101010101010509090909090906010101010101
0101010101010103030303030301010101010101
0101010101010101010101010101010101010101
0101010101010101010101010101010101010101
0100
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040b0404040404040404040404040b040410
0504040b040b0b0404040404040b0b040b04040d
0103030704040404040b0b040404040408030303
0101010504040404040b0b040404040406010101
0101010504040404080303070404040406010101
010101050a0a0a0a060101050a0a0a0a06010101
0101010509090909060101050909090906010101
0101010509090909060101050909090906010101
0101010509090909060101050909090906010101
0101010509090909060101050909090906010101
0101010103030303010101010303030301010101
0200
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
050404040b0b070a0a08070a0a080b0b04040410
05040404041005090906050909060f040404040d
010307040404100c0c0c0c0c0c0f040404080303
0101050404040404040404040404040404060101
0101010307040404040404040404040803010101
0101010105040404040404040404040601010101
0101010101030704040404040408030101010101
010101010101050a0b0a0a0b0a06010101010101
0101010101010509090909090906010101010101
0101010101010509090909090906010101010101
0101010101010103030303030301010101010101
0300
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040b120a0a0a0a120b040404040406
0103070404040411090909091104040404040406
01010504040404100c0c0c0c0f04040404040406
0101010307040404040404040404040807040410
010101010504040404040404040404060504040d
0101010105040404040404040404040601030303
0101010101030704040404040408030101010101
010101010101050a0a0b0b0a0a06010101010101
0101010101010509090909090906010101010101
0101010101010103030303030301010101010101
0400
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404120a0a120404040404040406
0504040404040404110909110404040404040406
0504040404040404100c0c0f0404040404040406
0504040404040404040404040404040404040406
05040404040b0b0404040404040b0b0404040406
0504040404040404040404040404040404040410
050404040404040b120a0a120b0404040404040d
0103030704040404110909110404040408030303
010101050a0a0a0a060303050a0a0a0a06010101
0101010509090909060101050909090906010101
0101010509090909060101050909090906010101
0101010103030303010101010303030301010101
0500
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
050404040404120a0a0803070a0a120404040406
0504040404041109090601050909110404040406
050404040b0b100c0c0c0c0c0c0c0f0b0b040406
0504040404040404040404040404040404040410
050404040404040404040404040404040404040d
050b0b0404040404040404040404040404080303
050b0b0b0404040404040b040404040404100c01
050a0a0a0a0a08070a0a0a0a0a08070a0a0a0a06
0509090909090605090909090906050909090906
0103030303030101030303030301010303030301
0600
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040410
050404040404040404040404040404040404040d
05040404040b120a0a0a120b04040404040b0b08
0504040404041109090911040404040404040406
050404040404100c0c0c0f04040404120a0a0a06
0504040404040404040404040404041109090906
0103030704040404040404040404041109090906
0101010504040404040404120a0a0a0603030301
0101010504040404040404110909090601010101
0101010504040404040404110909090601010101
0101010103030303030303010303030101010101
0700
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404120a0a120404040404040410
050404040404040411090911040404040404040d
050b0b0b0404040b100c0c0f0b0b0b0404040b08
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
050404040b0b0404040404040404040b0b040406
0504040404040404040404040404040404040406
050a0a0a0a0a08070b04040b08070a0a0a0a0a06
05090909090906050a0a0a0a0605090909090906
0509090909090605090909090605090909090906
0103030303030101030303030101030303030301
0001
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c01
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404040404040404040404040406
0504040404040404041f20210404040404040406
0504040404040404041a1e1d0404040404040406
0504040404040404041b191c0404040404040406
0504040404040404041b191c0404040404040406
0504040404040404041b191c0404040404040406
0504040404040404080303030704040404040406
0504040404040408010101010107040404040406
0103030303030301010101010101030303030301
0101
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000029282900272929260027292600000000
0000000000230000230000230023222400000000
0000000000230000252222240023000000000000
0000000000000000000000000000000000000000
0000000023002300272929260027292600000000
0000000023222a00230000230023222400000000
0000000023002300252222240023000000000000
0000080303030303030303030303030303070000
0000100c0c0c0c0c0c0c0c0c0c0c0c0c0c0f0000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
0000000000000000000000000000000000000000
__SFX__
00 00010000162940172a40172b40172c40162d40162e40162f40153040153140153240143340143440143540133640133740133840142940142a40142b40142c40132d40132e40132f40133040123140123240123340123440113540113640113740113840
01 00010000132400143470133470123470113470000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02 00010000133470133670143870143a70153470153470153470153470143470143470143570143670133770133870133470123470123470123470113470113470113470103470000000000000000000000000000000000000000000000000000000000000
03 00010000162630172730172830172930162a30162b30162c30152d30152c30152b30142a30142930142830132730132630132630142730142830142930142a30132b30132c30132d30132e30122f30123030123130123230113330113430113530113630
04 00010000173040173740173d40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05 00010000112d70133070153370173670102d70102d70153670153670153570153570143470143470143370143370133270133270133170133170123070123070122f70122f70112e70112e70112d70112d70000000000000000000000000000000000000
06 00020000152840132840162c40142c40172f40152f40173240153240162840142840162c40142c40152f40132f40153240133240142840122840142c40122c40142f40122f40143240123240132840112840132c40112c40132f40112f40133240113240
07 00060000152420142730162b40132730152b20142f30142b40152f30133120162b30142f20173120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08 00020000143070153070153170153170153270153270153370153370143470143470143570143570143670143670133670133670133670133670133670123670123570123570123470123470123370113370113270113270113170113170113070113070
__MUS__
00 110007080000000
