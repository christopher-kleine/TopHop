pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
level=0
start_y=72
mode="title"

poke(0x5f2d,0x1)

function solid(x,y)
 return solids[mget((x)/8,(y)/8)]
end

function spring(x,y)
 return springs[mget((x)/8,(y)/8)]
end

function _init()
 solids={
	 [1]=true,
	 [2]=true,
	 [3]=true,
	 [5]=true,
	 [6]=true,
	 [7]=true,
	 [8]=true,
	 [11]=true,
	 [12]=true,
	 [14]=true,
	 [15]=true,
	 [16]=true,
	 [17]=true,
	 [18]=true
	}
	springs={
	 [3]=true,
	 [7]=true,
	 [8]=true,
	 [11]=true,
	 [14]=true,
	 [18]=true
	}
	map_off=level*16
	p={
	 x=8+map_off*8,
		y=start_y,
		vx=0,
		vy=0,
		s=0.35
 }
	f=0
	mc=0
	sp=3
end

music(0)
function _update60()

 if mode=="title" then
		if btnp(4) then 
		 mode="game" 
			sfx(5)
		end

 elseif mode=="ending" then
  if btnp(4) then
		 level=0
   start_y=72
		 _init()
			mode="title"
			music(0) 
		end
	
	elseif mode=="pause" then
	 if btnp(4) then 
		 mode="game"
			sfx(4) 
		end
	
 elseif mode=="game" then

  p.s=0.35+level/15
 	map_off=level*16
 
  if p.vy==0 then
   p.vx=p.s
 	else
 	 if jumping==true then
	   p.vx=p.s*1.75
	 	else
	 	 p.vx=0
 		end
 	end
	
 	if solid(p.x+p.vx,p.y+p.vy) or solid(p.x+7+p.vx,p.y+p.vy) or solid(p.x+p.vx,p.y+7+p.vy) or solid(p.x+7+p.vx,p.y+7+p.vy) then
 	 p.vx=0
 	end
	
 	if solid(p.x,p.y+8+p.vy) or solid(p.x+7,p.y+8+p.vy) then
   p.vy=0
 		jumping=false
 	else
 	 p.vy=p.vy+0.2
 	end
	
 	if p.vy==0 and mget(p.x/8,p.y/8+1)==2 then 
 		p.vy=-3.5 
 		jumping=true
			sfx(0)
	 end

  if p.vy<0 and (solid(p.x+p.vx,p.y+p.vy) or solid(p.x+7+p.vx,p.y+p.vy)) then
   p.vy=0
 	end
	
  if mget(p.x/8,p.y/8+1)==9 then
 	 _init()
		 reload(0x2000,0x2000,0x2000)
			sfx(2)
	 end
	
	 if mget(p.x/8,p.y/8)==13 then
		 reload(0x2000,0x2000,0x2000)
		 if level==5 then
	   mode="ending"
				music(-1)
				sfx(7)
			else
			 p.x=p.x+16
	 	 start_y=p.y
	   level=level+1
	 	 sp=3
				sfx(3)
			end
 	end
	
	 p.x=p.x+p.vx
	 p.y=p.y+p.vy
	
	 if mp==1 then
	  if mc==0 then
		  if spring(mx+map_off*8,my) and sp>0 then
	    mset(mx/8+map_off,my/8,2)
		 		sp=sp-1
					sfx(1)
		 	elseif mget(mx/8+map_off,my/8)==2 and (p.vy>0 or jumping==false) then
		 	 mset(mx/8+map_off,my/8,14)
		 		sp=sp+1
					sfx(1)
		 	end
	 	end
	 	mc=mc+1
	 else
	  mc=0
	 end
	
	 if btnp(4) then 
		 mode="pause"
			sfx(4) 
		end
	
	 if sp>=3 then sp=3 end
 	if mc>=1 then mc=1 end
	
 	f=(f+p.s/5)%4
 	
	end
	mx=stat(32)
 my=stat(33)
 mp=stat(34)
end

function _draw()
 cls()
 if mode=="title" then
  map(16,16)
		print("a tiny challenge",4*8,8*8+5,1)
		print("press o/z to start",3*8+4,12*8,7)
		print("mega sparkmaster",4*8,15*8,13)
	elseif mode=="ending" then
	 map(0,16)
		print("congratulations!",4*8,2*8,10)
		print("".."you have finally".."\n".."reached the exit...",4*8,4*8,7)
  print("thanks for playing!",3*8+4,7*8,10)
		print("press o/z to return",3*8+4,8*8,6)
 elseif mode=="pause" then
  map(map_off,0)
		spr(19+f,p.x-map_off*8,p.y)
		print("area "..level+1,10,10,7)
		print("springs: "..sp,9*8+7,10,6) 
		print("pause",6*8+6,8*8,7)
	elseif mode=="game" then
	 map(map_off,0)
 	rect(flr(mx/8)*8,flr(my/8)*8,flr(mx/8)*8+7,flr(my/8)*8+7,7)
 	spr(19+f,p.x-map_off*8,p.y)
		print("area "..level+1,10,10,7)
		print("springs: "..sp,9*8+7,10,6)  
	end
	spr(23,mx,my)
end
__gfx__
00000000aaaaaaaadd6776dd3333333350000005aaaaaa9999aaaaaa33333335533333337777777750000005d667766daaaaaaaa03bbbb30dd0dd0ddaaaaaa99
00000000aaa9aaa9d28ee82dbbabbbab05000050aaa9aa9499a9aaa9bbabbba33babbbab77cc77cc05cc00ccddd66dddaaa9aaa933b77b33d500005daaa9aa94
007007009999999922baab22abb3abb3005005009999994444999999abb3abb33bb3abb3ccccccccccccccccd567765d99999999303773030050050099999944
0007700099949994238ee832333433340005500099949942449499943334333233343334cc11cc11cc11cc116d6776d69994999433b77b33d005500d99949942
0007700044444444238ee83244444444000550004444442222444444444444222244444411111111111111116d6776d63334333403bbbb30d005500d33343332
007007004449444922baab2244494449005005004449442422494449444944242249444911cc11cc11cc11ccd567765dabb3abb333b77b3300500500abb3abb3
0000000099999999d28ee82d999999990500005099999944449999999999994444999999ccccccccccccccccddd66dddbbabbbab30377303d500005dbbabbba3
00000000999a999add6776dd999a999a50000005999a9949449a999a999a9949449a999acc77cc77cc77cc77d667766d3333333333b77b33dd0dd0dd33333335
99aaaaaa99aaaa995333333500088800000000000008880000000000010000000d000d005000002228000d000d00082020000005288998825000222888999988
99a9aaa999a9aa943babbba300889200000888000088920000088800171000000600060005008888890006000600098088800050899aa9980500888999aaaa99
44999999449999443bb3abb300899900008892000089990000889200177100000600060000599900890006000600098009990500060006000050877777d77777
449499944494994233343332000b3000008999000003b000008999001777100007000700009a07009a00070007000a90070a9000070007000005877777777bbb
333433342244442222444422000b3000000b30000003b0000003b000177771000700070008a007009a00070007000a900700a800070007000005867777d777bb
3bb3abb322494424224944240009c00000933400000c9000000c3900177110000600060008900600890006000600098006009800060006000050866666666663
3babbbab4499994444999944000cc000001cc000000cc00000cc1000011710000600060029000600890006000600098006000920060006000500866666566666
53333333449a9949449a994900044000022044000004400002204400000000000d000d0028000d0028000d000d0008200d0008200d000d005000888999aaaa99
889999888222000500000000055d6d55055d6d55055d6d5522200000000000222222255522222555055d6d550000000000000000000000000000000000000000
99aaaa99988800502222255505d676d525d676d505d676d58882200000002288888285d5888285d555d676d50000000000000000000000000000000000000000
77777d7777780500888285d5055d6d55255d6d55055d6d55998882000002888999989d6d99989d6d5d5d6d550000000000000000000000000000000000000000
bbb777777778500099989d6d0289a98299a89820002898a9aa9928200028299aaaa9a676aaa9a676d6d9a9820000000000000000000000000000000000000000
bb777d7777685000aaa9a67602289822aa9928200028299a99a89820002898a999989d6d99989d6d676898220000000000000000000000000000000000000000
366666666668050099989d6d0289a9829988820000028889255d6d55055d6d55855d6dd5888285d5d6d9a9820000000000000000000000000000000000000000
6666656666680050888285d50289a982888220000000228805d676d505d676d525d676d5222225555d59a9820000000000000000000000000000000000000000
99aaaa9998880005222225550289a9822220000000000022055d6d55055d6d55055d6d55000000005559a9820000000000000000000000000000000000000000
__map__
010c0c0c0c0c0c0c0c0c0c0c0c0c0c01010c0c0c0c0c0c0c0c0c0c0c0c0c0c01010c0c0c0c0c0c0c0c0c0c0c0c0c0c01010c0c0c0c0c0c0c0c0c0c0c0c0c0c01010c0c0c0c0c0c0c0c0c0c0c0c0c0c01010c0c0c0c0c0c0c0c0c0c0c0c0c0c010000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040406050404040404040404040404040404060504040404040404040404040404040605040404040b040404040b040404040605040404040404040404040404040406050404040404040404040404040404060000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040406050404040404040404040404040404060504040404040404040404040404040605040404040b040404040b0404040406050404040404040b0b04040404040406050404040404040404040404040404060000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040605040404040404040404040404040406050404040404040404040404040404060504040404040404040404040404040605040404040404040404040404040406050404040404040404040404040404100000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040406050404040404040404040404040404060504040404040404040404040404040605040404040404040404040404040406050404040404120a0a120404040404060504040404040404040404040404040d0000000000000000000000000000000000000000000000000000000000000000
050404040404040b0b0404040404040605040404040404040404040404040406050404040404040404040404040404060504040404120b04040b12040404040605040404040411090911040404040406050404040404040404040404040408030000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040406050404040404040404040404040404060504040404120a0b0b0a1204040404060504040404110a0a0a0a110404040406050404040404100c0c0f0404040404060504040404040404040b0b0b040410010000000000000000000000000000000000000000000000000000000000000000
050404040b0b040404040b0b04040406050404040b0404040404040b04040406050404040b1109090909110b040404060504040404110909090911040404040605040404040b040404040b0404040406050404040404040404040404040404060000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040410050404040404040b0b04040404040410050404040b100c0c0c0c0c0b04040410050404040b100c0c0c0c0f0b040404100504040404040404040404040404041005040404040b0b0b04040404040404060000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040d050404040404040b0b0404040404040d0504040404040404040404040404040d0504040404040404040404040404040d0504040404040404040404040404040d050404040404040404040404120a0a060000000000000000000000000000000000000000000000000000000000000000
010307040404040404040404040803030103070404040803030704040408030301030704040404040404040404080303010307040404040404040404040b0b0801030704040b120a0a120b0404080303050404040404040404040404110909060000000000000000000000000000000000000000000000000000000000000000
0101050404040b04040b0404040601010101050a0a0a060101050a0a0a060101010105040404040404040404040601010101050404040404040404040404040601010504040411090911040404060101010307040404040404040404110909060000000000000000000000000000000000000000000000000000000000000000
01010103070a0a0a0a0a0a0803010101010105090909060101050909090601010101010307040404040404080301010101010103070b040404040b08070404060101050b0a0a060303050a0a0b0601010101050404040404120a0a0a060303010000000000000000000000000000000000000000000000000000000000000000
010101010509090909090906010101010101050909090601010509090906010101010101050a0b0a0a0b0a060101010101010101050a0a08070a0a06050a0a0601010509090906010105090909060101010105040404040411090909060101010000000000000000000000000000000000000000000000000000000000000000
0101010105090909090909060101010101010509090906010105090909060101010101010509090909090906010101010101010105090906050909060509090601010509090906010105090909060101010105040404040411090909060101010000000000000000000000000000000000000000000000000000000000000000
0101010101030303030303010101010101010103030301010101030303010101010101010103030303030301010101010101010101030301010303010103030101010103030301010101030303010101010101030303030301030303010101010000000000000000000000000000000000000000000000000000000000000000
010c0c0c0c0c0c0c0c0c0c0c0c0c0c0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600002928290027292926002729260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600000023000023000023002322240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600000023000025222224002300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600002300230027292926002729260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05040404040404040404040404040406000023222a0023000023002322240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600002300230025222224002300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404040404040404040404040600080303030303030303030303030700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404041e1f202104040404040600100c0c0c0c0c0c0c0c0c0c0c0c0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
050404040404191d1d1c04040404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404041a18181b04040404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404041a18181b04040404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040404080303030307040404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0504040408010101010101070404040600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103030301010101010101010303030100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200001a3301b3401c3501d3501e3501f340203402134022340233402434025330263302733028330293302a3301c3201d3201e3201f320203202132022320233102431025310263102731028310293102a310
00020000180301f640266302662026610006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00020000306103161032620336203463035630366303763038630396303a630306303063030620306203062030620306203062030620316203262033610346103561036610376103061030610306103061030610
000200000f4501245015450184401b4401e4401c4301b43019430174201542013420114100f410104301143012430134301443015430164201742018420194201a4201b4201c4101d4101e4101f4102041021410
00020000243502c330333100030001300013000030000300003000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200001d610256202c630336403360033600346303464031640316402d6402d6402964029630256302563022630226301f6301f6201c6201c62019620196201662016610136101361010610106100d6100d610
001600001261012610126101261012620126201262012620126301263012630126301263012630126301263012620126201262012620126101261012610126101261012610126101261012610126101261012610
000400001c3401c3502035020350233502335027350273501c3401c3302034020330233402333027340273301c3301c3102033020310233302331027330273101c3201c300203202030023320233002732027300
0006000018450184101b4501b4101f4501f4101b4401b4201f4401f42023440234201f4401f430234402343026440264301f4401f440234402344026430264200000000000000000000000000000000000000000
000800000015000150001500015000140001400014000140001300013000130001300012000120001200012000110001100011000110005000050000500005000050000500005000050000500005000050000500
00040000246302464027640276402a6402a6402d6402d6402f6402f6303163031630336303363033630336303362033620336203362031620316202e6202e6202c6102c610296102961026610266102361023610
__music__
00 08090a44

